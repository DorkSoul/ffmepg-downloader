================================================================================
                    VIDEO DOWNLOADER ARCHITECTURE
================================================================================

SYSTEM OVERVIEW
===============

┌─────────────────────────────────────────────────────────────────┐
│                         User's Browser                          │
│                    (Any device on network)                      │
└────────────────┬───────────────────────┬────────────────────────┘
                 │                       │
                 │ Port 5000             │ Port 6080
                 │ (Web UI)              │ (noVNC - Chrome viewer)
                 ▼                       ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Docker Container                           │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                    Supervisor                             │ │
│  │              (Process Manager)                            │ │
│  └─┬────────┬────────┬────────┬────────────────────────────┬─┘ │
│    │        │        │        │                            │   │
│    ▼        ▼        ▼        ▼                            ▼   │
│  ┌────┐  ┌────┐  ┌──────┐  ┌──────┐                    ┌────┐ │
│  │Xvfb│  │VNC │  │noVNC │  │Flask │                    │    │ │
│  │:99 │  │    │  │      │  │ App  │                    │    │ │
│  └────┘  └────┘  └──────┘  └──┬───┘                    │    │ │
│                                │                        │    │ │
│                                ├─── Direct Mode ────────┤    │ │
│                                │    • Get URL           │    │ │
│                                │    • Call FFmpeg       │    │ │
│                                │    • Save to /downloads│    │ │
│                                │                        │    │ │
│                                ├─── Browser Mode ───────┤    │ │
│                                │    • Launch Chrome     │ FF │ │
│                                │    • Monitor Network   │ mp │ │
│                                │    • Detect Stream     │ eg │ │
│                                │    • Generate Thumb    │    │ │
│                                ▼    • Call FFmpeg       │    │ │
│                           ┌────────┐                    │    │ │
│                           │ Chrome │                    │    │ │
│                           │ + CDP  │────────────────────┤    │ │
│                           │        │  Stream URL        │    │ │
│                           └────────┘                    └────┘ │
│                                │                               │
└────────────────────────────────┼───────────────────────────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │   Docker Volumes       │
                    ├────────────────────────┤
                    │ ./downloads/           │ ← Downloaded videos
                    │ ./chrome-data/         │ ← Cookies & profile
                    └────────────────────────┘


DATA FLOW - DIRECT DOWNLOAD
============================

User Input
    │
    ▼
┌──────────────┐
│ Paste URL    │ .m3u8, .mp4, .mpd, etc.
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ Flask API    │ /api/direct-download
└──────┬───────┘
       │
       ▼
┌──────────────┐
│   FFmpeg     │ Downloads stream
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ /downloads/  │ video_timestamp.mp4
└──────────────┘


DATA FLOW - BROWSER MODE
=========================

User Input
    │
    ▼
┌──────────────────┐
│ Paste Webpage    │ https://site.com/watch?v=...
└────────┬─────────┘
         │
         ▼
┌────────────────────┐
│ Flask API          │ /api/browser-download
└────────┬───────────┘
         │
         ├───────────────────────┐
         │                       │
         ▼                       ▼
┌────────────────┐      ┌───────────────┐
│ Launch Chrome  │      │ Show noVNC    │
│ Open URL       │      │ User can see  │
└────────┬───────┘      │ and interact  │
         │              └───────────────┘
         │ User logs in (first time)
         │ or video loads (cached cookies)
         │
         ▼
┌────────────────────────┐
│ Monitor Network (CDP)  │
│ • Capture all requests │
│ • Filter for video     │
│ • Detect .m3u8/.mpd    │
└────────┬───────────────┘
         │
         ▼
┌────────────────┐
│ Stream Found!  │ https://cdn.com/stream.m3u8
└────────┬───────┘
         │
         ├─────────────────┬─────────────────┐
         │                 │                 │
         ▼                 ▼                 ▼
    ┌─────────┐    ┌──────────────┐  ┌──────────┐
    │ FFmpeg  │    │ Generate     │  │ Show     │
    │Download │    │ Thumbnail    │  │ Popup    │
    └────┬────┘    └──────┬───────┘  └────┬─────┘
         │                │               │
         │                │               │ 15 sec countdown
         │                │               │ or user closes
         ▼                ▼               ▼
    ┌──────────────────────────────────────┐
    │ Close Chrome                         │
    └──────────────────────────────────────┘


COOKIE PERSISTENCE
==================

First Visit:
  User logs in manually
       │
       ▼
  Chrome saves to /home/appuser/.config/google-chrome
       │
       ▼
  Docker volume: ./chrome-data/

Subsequent Visits:
  Chrome loads from ./chrome-data/
       │
       ▼
  Session already authenticated
       │
       ▼
  Video loads immediately


COMPONENT RESPONSIBILITIES
===========================

┌─────────────┬──────────────────────────────────────────┐
│ Component   │ Role                                     │
├─────────────┼──────────────────────────────────────────┤
│ Flask       │ • Web server                             │
│             │ • REST API                               │
│             │ • Session management                     │
├─────────────┼──────────────────────────────────────────┤
│ Selenium    │ • Chrome automation                      │
│             │ • Browser control                        │
├─────────────┼──────────────────────────────────────────┤
│ Chrome CDP  │ • Network monitoring                     │
│             │ • Stream detection                       │
├─────────────┼──────────────────────────────────────────┤
│ FFmpeg      │ • Stream downloading                     │
│             │ • Thumbnail generation                   │
│             │ • Format handling                        │
├─────────────┼──────────────────────────────────────────┤
│ Xvfb        │ • Virtual display                        │
│             │ • Headless X server                      │
├─────────────┼──────────────────────────────────────────┤
│ x11vnc      │ • VNC server                             │
│             │ • Screen sharing                         │
├─────────────┼──────────────────────────────────────────┤
│ noVNC       │ • Web VNC client                         │
│             │ • Browser-based viewing                  │
├─────────────┼──────────────────────────────────────────┤
│ Supervisor  │ • Process management                     │
│             │ • Auto-restart services                  │
└─────────────┴──────────────────────────────────────────┘


NETWORK DIAGRAM
===============

        Internet
            │
            ▼
    ┌───────────────┐
    │ Video Sites   │ Streams, Auth, Content
    └───────┬───────┘
            │
            ▼
    ┌────────────────────────────────┐
    │ Your Network                   │
    │  ┌──────────┐  ┌─────────────┐│
    │  │ Your PC  │  │ UGREEN NAS  ││
    │  │          │  │             ││
    │  │ Browser  │  │  Docker     ││
    │  │  :5000 ──┼──┤  Container  ││
    │  │  :6080 ──┼──┤             ││
    │  └──────────┘  └─────────────┘│
    └────────────────────────────────┘


SECURITY MODEL
==============

┌─────────────────────────────────────┐
│ Container Isolation                 │
│ • Non-root user (appuser)          │
│ • No --privileged mode             │
│ • Minimal exposed ports            │
└─────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│ Network Security                    │
│ • Local network only (default)     │
│ • No internet exposure             │
│ • Recommend VPN for remote access  │
└─────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│ Data Security                       │
│ • Cookies stored locally           │
│ • No cloud services                │
│ • Volume-based persistence         │
└─────────────────────────────────────┘


RESOURCE USAGE
==============

Memory Timeline:
  Idle:     ~500 MB
  Chrome:   +500-800 MB
  Download: +100-300 MB
  Peak:     ~1.5-2 GB

CPU Timeline:
  Idle:     <5%
  Chrome:   10-30%
  Download: 20-50%

Disk I/O:
  Streaming: High (continuous write)
  Optimal:   SSD or fast HDD


================================================================================
